<!doctype html><html><head><meta charset="utf-8"><title>Update Membership</title><link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' rel='stylesheet'>
<script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js'></script></head><body><script>
if(!localStorage.getItem('role') && !location.pathname.endsWith('login.html')) { location.href = '/login.html'; }
function logout(){ localStorage.removeItem('role'); location.href='/login.html'; }
function roleHeader(){ return {'x-role': localStorage.getItem('role')||''}; }
</script>
<div class="container mt-4"><h4>Update Membership</h4><div class="mb-3"><label>Membership No</label><input id="mno" class="form-control"><button id="fetch" class="btn btn-sm btn-info mt-2">Fetch</button></div><div id="details" style="display:none;"><pre id="info"></pre><button id="extend" class="btn btn-primary">Extend 6 months</button> <button id="cancel" class="btn btn-danger">Cancel Membership</button></div></div>
<script>document.getElementById('fetch').addEventListener('click', async function(){ const mno = document.getElementById('mno').value.trim(); if(!mno){ alert('Enter membership no'); return; } const list = await (await fetch('/data/memberships.json')).json(); const m = list.find(x=>x.membership_no===mno); if(!m){ alert('Not found'); return; } document.getElementById('details').style.display='block'; document.getElementById('info').innerText = JSON.stringify(m, null, 2); document.getElementById('extend').onclick = async function(){ const res = await fetch('/api/memberships/'+mno, { method:'PUT', headers: Object.assign({'Content-Type':'application/json'}, roleHeader()), body: JSON.stringify({ action:'extend', extend_months: 6 }) }); const d = await res.json(); if(!res.ok){ alert(d.message||'Error'); return; } alert('Extended'); location.reload(); }; document.getElementById('cancel').onclick = async function(){ const res = await fetch('/api/memberships/'+mno, { method:'PUT', headers: Object.assign({'Content-Type':'application/json'}, roleHeader()), body: JSON.stringify({ action:'cancel' }) }); const d = await res.json(); if(!res.ok){ alert(d.message||'Error'); return; } alert('Canceled'); location.reload(); }; });</script>
</body></html>