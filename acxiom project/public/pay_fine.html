<!doctype html><html><head><meta charset="utf-8"><title>Pay Fine</title><link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' rel='stylesheet'>
<script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js'></script></head><body><script>
if(!localStorage.getItem('role') && !location.pathname.endsWith('login.html')) { location.href = '/login.html'; }
function logout(){ localStorage.removeItem('role'); location.href='/login.html'; }
function roleHeader(){ return {'x-role': localStorage.getItem('role')||''}; }
</script>
<div class="container mt-4"><h4>Pay Fine</h4><div id="info"></div><div id="formArea"></div></div>
<script>const tx = JSON.parse(localStorage.getItem('lastTransaction')||'null'); if(!tx){ document.getElementById('info').innerText='No transaction'; } else { document.getElementById('info').innerHTML = '<p>Transaction ID: '+tx.id+'</p><p>Fine: '+tx.fine+'</p>'; const area = document.getElementById('formArea'); area.innerHTML = "<div class='mb-2'><label>Fine Paid?</label><input type='checkbox' id='paid'></div><div class='mb-2'><label>Remarks</label><input id='remarks' class='form-control'></div><div id='err' class='text-danger mt-2'></div><button id='confirm' class='btn btn-primary mt-2'>Confirm</button>"; document.getElementById('confirm').onclick = async function(){ const paid = document.getElementById('paid').checked; if(tx.fine>0 && !paid){ document.getElementById('err').innerText='Fine must be paid'; return; } const res = await fetch('/api/payfine', { method:'POST', headers: Object.assign({'Content-Type':'application/json'}, roleHeader()), body: JSON.stringify({ transaction_id: tx.id, fine_paid: paid, remarks: document.getElementById('remarks').value }) }); const d = await res.json(); if(!res.ok){ document.getElementById('err').innerText=d.message||'Error'; return; } alert('Completed'); localStorage.removeItem('lastTransaction'); location.href='dashboard.html'; }; }</script>
</body></html>