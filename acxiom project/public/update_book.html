<!doctype html><html><head><meta charset="utf-8"><title>Update Book</title><link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' rel='stylesheet'>
<script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js'></script></head><body><script>
if(!localStorage.getItem('role') && !location.pathname.endsWith('login.html')) { location.href = '/login.html'; }
function logout(){ localStorage.removeItem('role'); location.href='/login.html'; }
function roleHeader(){ return {'x-role': localStorage.getItem('role')||''}; }
</script>
<div class="container mt-4"><h4>Update Book/Movie</h4><div class="mb-3"><label>Book ID</label><input id="bid" class="form-control"><button id="fetch" class="btn btn-sm btn-info mt-2">Fetch</button></div><form id="form" style="display:none;"><div class="mb-3"><label>Type</label><select id="category" class="form-select"><option value="Book">Book</option><option value="Movie">Movie</option></select></div><div class="mb-3"><label>Title</label><input id="title" class="form-control" required></div><div class="mb-3"><label>Author</label><input id="author" class="form-control" required></div><div class="mb-3"><label>Serial No</label><input id="serial" class="form-control" required></div><div class="mb-3"><label>Available</label><input type="checkbox" id="available"></div><div id="msg" class="text-danger"></div><button class="btn btn-primary">Update</button> <a class="btn btn-secondary" href="maintenance.html">Cancel</a></form></div>
<script>document.getElementById('fetch').addEventListener('click', async function(){ const id = document.getElementById('bid').value.trim(); if(!id){ alert('Enter ID'); return; } const res = await fetch('/api/books/'+id, { headers: roleHeader() }); if(!res.ok){ alert('Not found'); return; } const b = await res.json(); document.getElementById('form').style.display='block'; document.getElementById('title').value=b.title||''; document.getElementById('author').value=b.author||''; document.getElementById('serial').value=b.serial_no||''; document.getElementById('category').value=b.category||'Book'; document.getElementById('available').checked=!!b.available; document.getElementById('form').onsubmit = async function(e){ e.preventDefault(); const payload = { title: document.getElementById('title').value.trim(), author: document.getElementById('author').value.trim(), category: document.getElementById('category').value, serial_no: document.getElementById('serial').value.trim(), available: document.getElementById('available').checked }; const up = await fetch('/api/books/'+id, { method:'PUT', headers: Object.assign({'Content-Type':'application/json'}, roleHeader()), body: JSON.stringify(payload) }); const d = await up.json(); if(!up.ok){ document.getElementById('msg').innerText=d.message||'Error'; return; } alert('Updated'); location.href='maintenance.html'; }; });</script>
</body></html>